# TorrentClient

BitTorrent клиент для Windows, написанный на C# с использованием .NET 9.0 и Windows Forms.

## 🚀 Возможности

- ✅ **Полная поддержка протокола BitTorrent**
  - HTTP/HTTPS трекеры
  - UDP трекеры
  - TCP трекеры
  - DHT (Distributed Hash Table)
  - Peer Exchange (PEX)
  - Local Service Discovery

- ✅ **Управление загрузками**
  - Множественные одновременные загрузки
  - Приоритизация файлов
  - Автоматическое возобновление загрузок
  - Сохранение состояния торрентов

- ✅ **Контроль скорости**
  - Глобальные лимиты скорости загрузки/отдачи
  - Индивидуальные лимиты для каждого торрента
  - Алгоритм Token Bucket для точного контроля

- ✅ **Пользовательский интерфейс**
  - Современный Windows Forms интерфейс
  - Системный трей с уведомлениями
  - Отображение прогресса и статистики
  - Управление торрентами (добавление, удаление, пауза)

- ✅ **Дополнительные функции**
  - Поддержка cookies и headers для трекеров
  - Логирование операций
  - Автоматическое сохранение состояния
  - Потокобезопасная архитектура

## 📋 Требования

- **.NET 9.0 SDK** или выше
- **Windows 10/11** (x64)
- **Visual Studio 2022** или **Visual Studio Code** (для разработки)

## 🛠️ Сборка

### Клонирование репозитория

```bash
git clone https://github.com/yourusername/TorrentClient.git
cd TorrentClient
```

### Сборка проекта

```bash
dotnet build
```

### Запуск тестов

```bash
dotnet test
```

### Публикация

```bash
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true
```

## 📦 Структура проекта

```
TorrentClient/
├── Core/                    # Основная бизнес-логика
│   ├── TorrentManager.cs   # Менеджер торрентов
│   ├── TorrentDownloader.cs
│   └── AppSettingsManager.cs
├── Engine/                  # Движок BitTorrent
│   ├── TorrentClient.cs    # Главный клиент
│   ├── Swarm.cs            # Управление пирами
│   ├── Wire.cs             # Протокол обмена данными
│   └── Storage.cs          # Управление файлами
├── Protocol/                # Протоколы и сеть
│   ├── TrackerClient.cs    # Клиент трекеров
│   ├── PeerConnection.cs   # Соединения с пирами
│   ├── DhtNode.cs          # DHT узел
│   └── PiecePicker.cs      # Выбор кусков
├── UI/                      # Пользовательский интерфейс
│   ├── MainForm.cs         # Главная форма
│   └── Services/           # UI сервисы
├── Utilities/               # Утилиты
│   ├── Bencode.cs          # Парсинг Bencode
│   └── Logger.cs           # Логирование
└── TorrentClient.Tests/     # Тесты
    ├── BencodeParserTests.cs
    ├── SpeedLimiterTests.cs
    └── ...
```

## 🧪 Тестирование

Проект включает комплексный набор unit-тестов с использованием xUnit:

- **BencodeParserTests** - тесты парсера Bencode
- **SpeedLimiterTests** - тесты ограничителя скорости
- **GlobalSpeedLimiterTests** - тесты глобального ограничителя
- **UpdateThrottlerTests** - тесты троттлинга обновлений UI
- **PiecePickerTests** - тесты выбора кусков
- **AppSettingsManagerTests** - тесты менеджера настроек
- **TaskTimeoutHelperTests** - тесты утилит таймаутов

Запуск всех тестов:

```bash
dotnet test --verbosity normal
```

## 🏗️ Архитектура

Проект следует принципам SOLID и использует:

- **SRP (Single Responsibility Principle)** - каждый класс имеет одну ответственность
- **DIP (Dependency Inversion Principle)** - зависимость от абстракций через интерфейсы
- **Асинхронное программирование** - использование async/await для неблокирующих операций
- **Потокобезопасность** - использование `Lock`, `SemaphoreSlim` и других примитивов синхронизации
- **Управление памятью** - предотвращение утечек памяти через правильное использование `IDisposable`

## 📝 Использование

1. Запустите приложение
2. Добавьте `.torrent` файл через меню или перетаскиванием
3. Выберите путь для загрузки
4. Настройте лимиты скорости при необходимости
5. Отслеживайте прогресс в главном окне

## ⚙️ Настройки

Приложение сохраняет настройки в `appsettings.json`:

- Путь загрузки по умолчанию
- Глобальные лимиты скорости
- Cookies и headers для трекеров
- Максимальное количество соединений
- Включение/выключение логирования

## 🔧 Разработка

### Добавление новых функций

1. Создайте интерфейс в соответствующей папке `Interfaces/`
2. Реализуйте интерфейс в соответствующем модуле
3. Добавьте unit-тесты
4. Обновите документацию при необходимости

### Стиль кода

- Используйте `async/await` для асинхронных операций
- Следуйте соглашениям именования C#
- Добавляйте XML-комментарии для публичных API
- Используйте `using` для управления ресурсами